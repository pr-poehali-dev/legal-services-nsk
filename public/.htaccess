# Apache configuration for proper 404 handling
# Настройка для корректной обработки 404 ошибок

RewriteEngine On

# Запрещаем доступ к служебным файлам
<Files ~ "^\.">
    Require all denied
</Files>

# Запрещаем доступ к конфигурационным файлам
<FilesMatch "\.(env|config|json)$">
    Require all denied
</FilesMatch>

# Настройка MIME типов
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType application/xml .xml
    AddType text/plain .txt
</IfModule>

# Настройка кэширования
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType application/xml "access plus 1 day"
</IfModule>

# Настройка gzip сжатия
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# SPA routing - перенаправляем все запросы на index.html
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Если файл или папка существует, показываем их
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Все остальные запросы перенаправляем на index.html
    # React Router обработает маршрутизацию
    RewriteRule ^ index.html [L]
</IfModule>

# Настройка заголовков безопасности
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CORS для API запросов
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Кастомные страницы ошибок
ErrorDocument 404 /index.html
ErrorDocument 500 /index.html
ErrorDocument 403 /index.html